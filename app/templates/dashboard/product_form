{% extends "base.html" %}

{% block title %}{{ title }} - {{ super() }}{% endblock %}

{% block content %}
<div class="py-6">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <a href="{{ url_for('dashboard.products') }}" class="text-indigo-600 hover:text-indigo-500 mb-4 inline-block">
                <i class="fas fa-arrow-left mr-1"></i> Volver a productos
            </a>
            <h1 class="text-3xl font-bold text-gray-900">{{ title }}</h1>
        </div>

        <!-- Form -->
        <div class="bg-white shadow rounded-lg p-6">
            <form method="POST" enctype="multipart/form-data">
                {{ form.hidden_tag() }}
                
                <!-- Product Name -->
                <div class="mb-6">
                    {{ form.name.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    {{ form.name(class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm") }}
                    {% if form.name.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.name.errors[0] }}</p>
                    {% endif %}
                </div>
                
                <!-- Description -->
                <div class="mb-6">
                    {{ form.description.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    {{ form.description(class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm", rows="4") }}
                    {% if form.description.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.description.errors[0] }}</p>
                    {% endif %}
                </div>
                
                <!-- Price and Stock -->
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 mb-6">
                    <div>
                        {{ form.price.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm">$</span>
                            </div>
                            {{ form.price(class="appearance-none block w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm") }}
                        </div>
                        {% if form.price.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.price.errors[0] }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        {{ form.stock.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                        {{ form.stock(class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm") }}
                        {% if form.stock.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.stock.errors[0] }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Image Upload -->
                <div class="mb-6">
                    {{ form.image.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    
                    <!-- Current Image Preview (if editing) -->
                    {% if product and product.image %}
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-2">Imagen actual:</p>
                        <img src="{{ url_for('static', filename=product.image) }}" 
                             alt="{{ product.name }}" 
                             class="h-32 w-32 object-cover rounded-lg">
                    </div>
                    {% endif %}
                    
                    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                        <div class="space-y-1 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <div class="flex text-sm text-gray-600">
                                <label for="{{ form.image.id }}" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none">
                                    <span>Subir archivo</span>
                                    {{ form.image(class="sr-only", accept="image/*") }}
                                </label>
                                <p class="pl-1">o arrastra y suelta</p>
                            </div>
                            <p class="text-xs text-gray-500">PNG, JPG, GIF hasta 10MB</p>
                        </div>
                    </div>
                    {% if form.image.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.image.errors[0] }}</p>
                    {% endif %}
                </div>
                
                <!-- Submit Button -->
                <div class="flex justify-end space-x-3">
                    <a href="{{ url_for('dashboard.products') }}" 
                       class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Cancelar
                    </a>
                    {{ form.submit(class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 cursor-pointer") }}
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Preview image before upload
document.getElementById('{{ form.image.id }}').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
            // You could add image preview functionality here
            console.log('Image selected:', file.name);
        };
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}
